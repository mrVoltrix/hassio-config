- id: heating_morning_on_wd
  alias: heating - weekday morning
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.time'') == ( state_attr(''input_datetime.weekday_start'',
      ''timestamp'') | int | timestamp_custom(''%H:%M'', False) ) }}'
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: input_boolean.heating_timer
    state: 'on'
  - condition: state
    entity_id: person.sebastian
    state: home
  action:
  # - data_template:
  #     entity_id: climate.room_heating
  #     temperature: '{{ states(''input_number.target_temp_room_high'') }}'
  #   service: climate.set_temperature
  - data_template:
      entity_id: climate.bathroom_heating
      temperature: '{{ states(''input_number.target_temp_bathroom_high'') }}'
    service: climate.set_temperature
- id: heating_evening_off_wd
  alias: heating - weekday night
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.time'') == ( state_attr(''input_datetime.weekday_end'',
      ''timestamp'') | int | timestamp_custom(''%H:%M'', False) ) }}'
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: input_boolean.heating_timer
    state: 'on'
  - condition: state
    entity_id: person.sebastian
    state: home
  action:
  - data_template:
      entity_id: climate.room_heating
      temperature: '{{ states(''input_number.target_temp_room_low'') }}'
    service: climate.set_temperature
- id: heating_morning_on_we
  alias: heating - weekend morning
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.time'') == ( state_attr(''input_datetime.weekend_start'',
      ''timestamp'') | int | timestamp_custom(''%H:%M'', False) ) }}'
  condition:
  - condition: time
    weekday:
    - sat
    - sun
  - condition: state
    entity_id: input_boolean.heating_timer
    state: 'on'
  - condition: state
    entity_id: person.sebastian
    state: home
  action:
  - data_template:
      entity_id: climate.room_heating
      temperature: '{{ states(''input_number.target_temp_room_high'') }}'
    service: climate.set_temperature
  - data_template:
      entity_id: climate.bathroom_heating
      temperature: '{{ states(''input_number.target_temp_bathroom_high'') }}'
    service: climate.set_temperature
- id: heating_evening_off_we
  alias: heating - weekend night
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.time'') == ( state_attr(''input_datetime.weekend_end'',
      ''timestamp'') | int | timestamp_custom(''%H:%M'', False) ) }}'
  condition:
  - condition: time
    weekday:
    - sat
    - sun
  - condition: state
    entity_id: input_boolean.heating_timer
    state: 'on'
  - condition: state
    entity_id: person.sebastian
    state: home
  action:
  - data_template:
      entity_id: climate.room_heating
      temperature: '{{ states(''input_number.target_temp_room_low'') }}'
    service: climate.set_temperature
  - data_template:
      entity_id: climate.bathroom_heating
      temperature: '{{ states(''input_number.target_temp_bathroom_low'') }}'
    service: climate.set_temperature
- id: heating_on_when_home
  alias: heating - turn heating on on arrival
  trigger:
  - entity_id: person.sebastian
    from: not_home
    platform: state
    to: home
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: none
      entity_id: all
  - delay: 00:00:05
  - service: climate.set_temperature
    data_template:
      entity_id: climate.bathroom_heating
      temperature: '{{ states(''input_number.target_temp_bathroom_low'') }}'
  - service: climate.set_temperature
    data_template:
      entity_id: climate.room_heating
      temperature: '{{ states(''input_number.target_temp_room_high'') }}'
- id: heating_off_when_away
  alias: heating - turn off when we leave home
  trigger:
  - platform: state
    entity_id: person.sebastian
    from: home
    to: not_home
  action:
  - service: climate.set_temperature
    data_template:
      entity_id: climate.bathroom_heating
      temperature: '{{ states(''input_number.target_temp_bathroom_low'') }}'
  - delay: 00:00:05
  - service: climate.set_preset_mode
    data:
      preset_mode: away
      entity_id: all
- id: '1570365018863'
  alias: heating - kitchen on
  trigger:
  - platform: template
    value_template: '{{ (state_attr(''climate.room_heating'', ''temperature'') | float)
      - (states(''sensor.temperature_2'') | float) > 1.0}}'
  condition: []
  action:
  - device_id: b95dc98ae71941c68e4f32961e25ae2a
    domain: switch
    entity_id: switch.ikea_plug_2
    type: turn_on
- id: '1570365069845'
  alias: heating - kitchen off
  trigger:
  - platform: template
    value_template: '{{ (state_attr(''climate.room_heating'', ''temperature'') | float)
      - (states(''sensor.temperature_2'') | float) < 0.5 }}'
  condition: []
  action:
  - device_id: b95dc98ae71941c68e4f32961e25ae2a
    domain: switch
    entity_id: switch.ikea_plug_2
    type: turn_off
- id: 'heating_bathroom_off'
  alias: heating - turn off bathroom heating
  trigger:
  - platform: state
    entity_id: switch.osram_plug_3
    from: 'on'
    to: 'off'
    for: 00:05:00
  condition:
  - condition: template
    value_template: '{{ (state_attr(''climate.bathroom_heating'', ''temperature'') | float)
      >= (states(''input_number.target_temp_bathroom_high'') | float) }}'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.osram_plug_4
  - service: climate.set_temperature
    data_template:
      entity_id: climate.bathroom_heating
      temperature: '{{ states(''input_number.target_temp_bathroom_low'') }}'